= Script: NVS 4
:toc:


// Metadata
:author: GeorgSeng
:date: 2019-12-07
:revision:  1.5

// Settings
:source-highlighter: coderay
:icons: font
:sectnums:    // Nummerierung der Überschriften / section numbering
:pdfwidth: pdfwidth=80vw
// Refs:
:imagesdir: /home/georg/Documents/Data/repos/4NVS/Documents/images
//:imagesdir: images
//:sourcedir-code: src/main/java/at/htl/jdbcprimer
//:sourcedir-test: src/test/java/at/htl/jdbcprimer

 
Version: {revision}


//General

//
=== Create Project

Create *Maven* Project with Intellij.
For Example:
[source, xml]
----
    <groupId>at.htl</groupId>
    <artifactId>PersonRest</artifactId>
----

//
=== Pom.xml
.Pom.xml
[source, XML]
----
    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>

        <groupId>at.htl</groupId>
        <artifactId>vehicle</artifactId>
        <version>1.0-SNAPSHOT</version>
        <packaging>war</packaging>

                <properties>
            <maven.compiler.source>11</maven.compiler.source>
            <maven.compiler.target>11</maven.compiler.target>
        </properties>

        <dependencies>
            <dependency>
                <groupId>jakarta.platform</groupId>
                <artifactId>jakarta.jakartaee-api</artifactId>
                <version>8.0.0</version>
                <scope>provided</scope>
            </dependency>
            <dependency>
                <groupId>jakarta.xml.bind</groupId>
                <artifactId>jakarta.xml.bind-api</artifactId>
                <version>2.3.2</version>
                <scope>provided</scope>
            </dependency>
        </dependencies>

        <build>
            <finalName>vehicle</finalName>
        </build>


    </project>
----

.Useful Package sources
[source, XML]
----
                            <!-- Useful Sources -->
    <!-- https://mvnrepository.com/artifact/junit/junit -->
    <!-- https://mvnrepository.com/artifact/org.glassfish.jersey.core/jersey-client -->
    <!-- https://mvnrepository.com/artifact/org.glassfish.jersey.media/jersey-media-json-processing -->
    <!-- https://mvnrepository.com/artifact/org.glassfish/javax.json -->
    <!-- https://mvnrepository.com/artifact/org.glassfish.jersey.inject/jersey-hk2 -->
    <!-- https://mvnrepository.com/artifact/org.hamcrest/hamcrest -->
----

//
=== Configure Data Source & and Drivers

*Start DerbyDB*

.Start DB:
[source, shell]
----
demoTest101/db$ /opt/db-derby-10.14.2.0-bin/bin/startNetworkServer -noSecurityManager
----

*Configure in IJ*
|===
| *Option* | *Input*

| Driver | Apache Derby (Remote)

| Host | localhost

| Port | 1527

| User | app

| Password | app

| Database | db

| URL | jdbc:derby://localhost:1527/db;create=true

|===

Good Source:
https://www.tutorialspoint.com/intellij_idea/index.htm


:hardbreaks:

//ProjectStructure
=== Project Structure

//image::Project_Structure.png[]

Source/main/java/at/htl/[ProjectName]/::
business/
model/
rest/

Source/main/java/at/htl/[ProjectName]/::
control/
entity/
boundary/


Source/main/resources/::
Files.csv
application.properties (Quarkus)
META-INF/ (WildFly) :::
    persistence.xml


//
* The source code is usually in 3 subdirectory of the main folder *at.htl.project_Name* Folder. The subdirectory are *business, model, rest*.

* In the *business folder* is the *InitBean.java* which 
contains the init method for the Application server.

* In the *model folder* are the *Entities*.

* In the *rest folder* is the *Endpoints.java* and the *RestConfig.java* which configures the rest service.

* For testing the REST service a *request.http* can be created this file should be placed in the *requests folder* which is a subdirectory of the project's root directory.

* The *resources folder* which is also a subdirectory of the project's root directory is for resources. Like: *csv files* or the folder *META-INF* which contains the *persistance.xml*.

//
==== Repository

.Example for a Repository
[source, JAVA]
----
@Transactional
public class CourseRepository {


    @PersistenceContext
    EntityManager em;
}
----

//
==== Entity

.Example Person
[source, Java]
----
    package at.htl.person.model;
    import javax.persistence.*;

    @Entity
    //@Entity(name = "Person")
    public class Person {
        @Transient
        DateTimeFormatter dtf = DateTimeFormatter.ofPattern("dd.MM.yyyy");

        @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
        @Column(name = "customer_name")
        private String name;
    }
----

//
===== XML-Root
For xml we have to declare the entity as: 

.Example for Entity with XML+
[source, Java]
----
    import javax.xml.bind.annotation.XmlRootElement;

    @XmlRootElement
    public class Vehicle {}
----

//
==== Rest Config

.Rest Config File
[source, java]
----
    package at.htl.vehicle.rest;

    import javax.ws.rs.ApplicationPath;
    import javax.ws.rs.core.Application;

    @ApplicationPath("api")
    public class RestConfig extends Application {

    }
----

//
==== InitBean (Read data from csv)

Good Source:
https://stuetzpunkt.wordpress.com/2016/12/28/how-to-access-file-in-resources-folder-javaee/

.Example for read csv in InitBean
[source, java]
----
    private void init(
        @Observes
        @Initialized(ApplicationScoped.class) Object object) {
        readCsv(FILE_NAME);
    }

    private void readCsv(String fileName) {
        URL url = Thread.currentThread().getContextClassLoader()
                .getResource(fileName);
        try (Stream<String> stream = Files.lines(Paths.get(url.getPath())
                , StandardCharsets.UTF_8)) {
            stream
                    .skip(1)
                    ...
                    .forEach(em::merge);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
----

//
==== Request.http

.Examples for a POST in request.http
[source, HTTP]
----
    POST http://localhost:8080/person/api/person
    Content-Type: application/json

    [
        {
            "dob": "2001-10-07",
            "name": "Chiara"
        },
        {
            "dob": "2002-03-23",
            "name": "Christoph"
        }
    ]
----

.Examples for GET in request.http
[source, HTTP]
----
    ### Get All as XML
    GET http://localhost:8080/person/api/person/demo
    Accept: application/xml

    ### Get Susi
    GET http://localhost:8080/person/api/person?name=Susi
----

//CDI
== CDI
=== Context Dependency Injection 
CDI is part of JavaBeans it can be configured in the beans.xml file.

With the @Inject the cdi can create a contextual instance of the Object / Class you want to have.

* Field injection type (most important): Request Context and Injected in a particular field (@Inject private RequestScope requestScop)

* Constructor injection point (Field gets initialized in the constructor using cdi):  @Inject private ScopesBean(DependentScope){this.dependentScope = dependentScope;}

* Method injection point is the same as Constructor method.


== Technologies

=== Jakarta EE
Good Source:
https://eclipse-ee4j.github.io/jakartaee-tutorial/

=== JUnit 4

.*Method Annotations*
|===
| *Tag* | *Description*
| @Test | Turns a public method into a JUnit test case.
| @Before | Method to run before every test case
| @After | Method to run after every test case
| @BeforeClass | Method to run once, before any test cases have run
| @AfterClass | Method to run once, after all test cases have run
|===

.*Assert Methods*
|===
| Method | Description
| assertTrue(test) | fails if the Boolean test is false
| assertFalse(test) | fails if the Boolean test is true
| assertEquals(expected, actual) | fails if the values are not equal
| assertSame(expected, actual) | fails if the values are not the same (by ==) have run
| assertNotSame(expected, actual) | fails if the values are the same (by ==)
| assertNull(value) | fails if the given value is not null
| assertNotNull(value) | fails if the given value is null
| fail() | causes current test to immediately fail
| assertEquals(“message”, expected, actual) | Each method can also be passed a string to display if it fails
|===

Good Source:
https://www.javatpoint.com/

== AsciiDoc

Great Source:
https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/

== Linux 

=== Terminal

|=== 
| *Command* | *Description*
| ll | list all files and folders
| chmod | change mode of a file
| chown | change user rights on a folder

|===

== Hints

=== Convert String to LocalDate

.*Example Problem*
[source, JAVA]
----
DateTimeFormatter dtf = DateTimeFormatter.ofPattern("dd-MM-yy");
String dateString = "03-07-88"; // 3rd of July 1988

LocalDate date = LocalDate.parse(dateString, dtf);

System.out.println(date); // --> 2088-07-03
----

When converting a String with a two-digit-year to a LocalDate variable, the base of the convertion is 2000 so you get 2088 as result.

.*Example Solution*
[source, java]
----
To prevent this, you can subtract 100 years in the DateTimeFormatter-Object

DateTimeFormatter dtf = new DateTimeFormatterBuilder()
        .appendPattern("dd-MM-")
        .appendValueReduced(ChronoField.YEAR, 2, 2, 1900)
        .toFormatter();

String dateString = "03-07-88"; // 3rd of July 1988

LocalDate date = LocalDate.parse(dateString, dtf);

System.out.println(date); // --> 1988-07-03
----
Now the correct date is displayed

Source:

- https://stackoverflow.com/a/38354449
- https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html

== Docker
Docker is a toll that gives you the opportunity to run applications in a small virtualization environment like a container. Docker is a major part for Microsrvices.

.Table useful commands
[options="header,footer"]
|=======================
| Command | Description
| docker ps | list running containers   
| docker inspect [container name] | list all information's about the container
|=======================


include::Persistance-with-jpa.adoc[]

include::Rest.adoc[]

include::Quarkus.adoc[]

